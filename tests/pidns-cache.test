#!/bin/sh
#
# Test pidns translation cache.
#
# Copyright (c) 2020 The strace developers.
# All rights reserved.
#
# SPDX-License-Identifier: GPL-2.0-or-later

. "${srcdir=.}/init.sh"

require_min_kernel_version_or_skip 4.9
check_prog timeout

run_prog > /dev/null
timeout 1 $STRACE -o /dev/null --pidns-translation -f -e trace=getpid $args || {
        rc=$?
        if [ $rc -eq 124 ]; then
                fail_ "pidns translation took too long"
        else
                fail_ "$args failed with code $rc"
        fi
}
