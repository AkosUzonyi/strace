#!/bin/sh
#
# Test PID namespace translation
#
# Copyright (c) 2020 √Åkos Uzonyi <uzonyi.akos@gmail.com>
# All rights reserved.
#
# SPDX-License-Identifier: LGPL-2.1-or-later

set -a
. "${srcdir=.}/init.sh"
set +a

require_min_kernel_version_or_skip 2.6.24
check_prog unshare

if [[ $(id -u) -ne 0 ]]; then
        skip_ "must be run as root"
fi

SYSCALLS='kill,gettid,getpid,getpgid,getsid,setsid,pidfd_open'
RUN_STRACE="run_strace_match_diff -a15 -Y -f -e trace=$SYSCALLS -e signal=none"

$RUN_STRACE
unshare -fp bash -c "$RUN_STRACE"
